<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Drush | A required tool for developers and sysadmins. | by Rich Allen</title>
    <meta name="description" content="A presenation for showing the usefulness of drush on modern drupal projects." />
    <meta name="author" content="Rich Allen" />
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />
    <link href="/stylesheets/taoti.css" media="screen" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="bower_components/impress.js/favicon.png" />
    <link rel="bower_components/impress.js/apple-touch-icon" href="apple-touch-icon.png" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
    <link href="google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="google-code-prettify/prettify.js"></script>
</head>
<body onload="prettyPrint()">
    <div id="impress">
        <div class="step slide">
            <h2>Drush:</h2><h3>A required tool for modern drupal developers and sysadmins.</h3>
            <h4>by Rich Allen and with Taoti Creative</h4>
        </div>
        <div class="step slide" data-x="1000">
            <h4>What is drush?</h4>
            <p>At it's simplest it's a command line tool for interacting and building components of drupal sites.</p>
        </div>
        <div class="step slide" data-x="2000">
            <h4>No really what can drush do?</h4>
            <ul>
                <li>Reset Accounts</li>
                <li>Export Data</li>
                <li>Trouble shoot production websites without having to actually log onto a device.</li>
                <li>
                    Deploy remotely. Don't deal with permissions and adding https connection strings
                    because dealing with multiple users and git is a pain.
                </li>
                <li>Lock down your devices to a single user.</li>
            </ul>
        </div>
        <div class="step slide" data-x="3000">
            <h4>Drush Aliases</h4>
            <p>
                STOP for the love of kittens documenting server information/inventory outside of your project.
                Add an alias file. It's trivial, it lives in code so developers don't waste time searching
                for documentation and credentials.
            </p>
            <p>
                Full documentation at
                <a href="https://github.com/drush-ops/drush/blob/master/examples/example.aliases.drushrc.php">
                    https://github.com/drush-ops/drush/blob/master/examples/example.aliases.drushrc.php
                </a></p>
        </div>
        <div class="step slide" data-x="4000"><pre class="prettyprint">
/**
* @file
* somewebsite.aliases.drushrc.php
* Depends on the following env variables being set.
* Place in your ~/.drush/drushrc.php
* global $dev_user
* $dev_user = 'yourSSHUserName';
* Repeat for any other environments
* # ln -s $projectRoot/somewebsite/somewebsite.aliases.drushrc.php ~/.drush/
*/
global $dev_user;
global $blkmsh_user;
$home = drush_server_home();
$aliases['dev'] = array('env' => 'dev',
    'root' => '/var/www/vhosts/somewebsite.org/public/docroot',
    'uri' => 'http://user:pass@somewebsite.taotidev.com',
    'remote-user' => $dev_user,
    'remote-host' => 'somewebsite.taotidev.com',
);
$aliases['prod'] = array(
    'env' => 'prod',
    'root' => '/var/www/somewebsite.org/htdocs/docroot',
    'uri' => 'https://somewebsite.org',
    'remote-user' => $blkmsh_user,
    'remote-host' => 'somewebsite.org',
    'path-aliases' => array(
        '%drush' => '/optcd/scripts/drush',
        '%site' => 'sites/default/',
    ),
);
$aliases['vagrant'] = array(
    'root' => '/var/www/docroot',
    'uri' => 'http://somewebsite.vagrant',
    'remote-user' => 'vagrant',
    'remote-host' => 'somewebsite.vagrant',
    'ssh-options' => "-p 22 -i " . $home . "/.vagrant.d/insecure_private_key",
);
            </pre>
        </div>
        <div class="step slide" data-x="5000">
            <h4>Ever update your project? Need fine tune control of versioning?</h4>
            <ul>
                <li>Drupal.org has structure that allows you to download any version of a project including
                    dev and beta releases that drush hooks into.
                </li>
                <li>
                    Combine with drush make to get the correct release with the patches you
                    need.
                </li>
                <li>Update your sites quickly and easily.
                    <pre class="prettyprint">
$drush @sitename.local up --lock=media,fieldcollection,mediacrop
$drush @sitename.local test-run --xml=/path/to/jenkins
                    </pre>
                </li>
            </ul>
            <p>Using git alone and updating by downloading and placing files you are almost promised that at some point
            you will loose a patch or get non-dev version when you need it for functionality.</p>
        </div>
        <div class="step slide" data-x="6000">
            <h4>Stop overriding php.ini settings.</h4>
            <p>You/your developers would never overwite php.ini memory limits just to import a large file or
                particularly large set of bash files right? Right?</p>
            <p>
                <img src="images/badroblowe.jpg" style="float:left; margin-right: 10px;"> Don't be poor decision
                Rob Lowe. use php-cli.ini
                and run your operations through separate user. The bad decision Rob Lowe leads to memory
                hungry applications.
            </p>
        </div>
        <div class="step slide" data-x="7000">
            <h4>What developers are missing.</h4>
            <p>The first and biggest thing is writing code over and over again.(yes I'm starting in drush contrib).<br>
                <a href="https://www.drupal.org/project/module_builder">
                    https://www.drupal.org/project/module_builder
                </a>
                and for Drupal 8 <a href="https://www.drupal.org/project/console">
                    https://www.drupal.org/project/console
                </a>(not drush, works the same though)
            </p>
            <pre class="prettyprint">
$drush @sitename.local mb my_module menu cron form form_alter permissions
menu_alter update install --write --name="My module" --dep="forum views"
            </pre>
        </div>
        <div class="step slide" data-x="8000">
            <h4>Export config from multiple environment using ctools and features. Don't wait for 'status' of
                a feature.
            </h4>
            <p>Large sites with lots of features are slow to work with. Features UI is PAINFULLY slow.</p>
            <p>Everytime you navigate to see the status of your feature it can take minutes per load. This
            can very easily add to hours of overhead when troubleshooting configuration.</p>
            <pre class="prettyprint">
$drush @sitename.local features-diff feature_name</pre>
        </div>
        <div class="step slide" data-x="9000">
            <h4>Another example: I need to recreate code that is over several features!</h4>
            Without drush:
            <ul>
                <li>Wait for features page to show status, find overridden.</li>
                <li>Click recreate/download</li>
                <li>Repeat x times</li>
            </ul>
            With drush: <pre class="prettyprint">
$drush @sitename.local features-update-all -y</pre>
            <img src="images/compiling.png">
        </div>
        <div class="step slide" data-x="10000">
            With drush and nix magic (probably want to alias this one):
            <pre class="prettyprint">
$drush fd | grep -E 'Overridden[[:space:]]+$' \|
sed -E 's/[[:space:]]*Enabled[[:space:]]*Overridden[[:space:]]*//' \ |
sed -E 's/.*[[:space:]]//' \| xargs drush fd
            </pre>
            This line of code has saved me personally hundreds of hours. You wouldn't believe how much time waiting
            for feature status can eat away 1-2 minutes at a time.
        </div>
        <div class="step slide" data-x="11000">
            <h4>Moving databases....constantly.</h4>
            <p>Drupal config is a pain because of how it's set up we are constantly moving databases around. Do this
            the smart way.
            <pre class="prettyprint">$drush sql-sync @somesite.live @somesite.local</pre></p>
            <p>Or you could:</p>
        </div>
        <div class="step slide" data-x="12000">
            <h4>It's your call</h4>
            <p>
                <pre style="float:left; margin-right: 10px; margin-top: 0px; display: inline;" class="prettyprint shell">
$ssh remoteEnv
$cat /var/www/drupal/sites/default/settings.php #check settings.php for table name
$mysqldump -uDrupal -p tablename > ~/somefile.sql
$exit
$scp remoteEnv:~/somefile.sql ~/Downloads
$scp ~/Downloads/somefile.sql localEnv:~/
$ssh localEnv
$cat /var/www/docroot/drupal/sites/default/settings.php
$mysql -uSomeNewDrupalUser -p anotherNewTable < ~/somefile.sql
                </pre><img style="display: inline;"src="images/no.gif">
        </div>
        <div class="step slide" data-x="13000">
            <h4>Moving content</h4>
            <p>No reason to ever build a vbo view for exporting content. Use drush.</p>
            <p><pre class="prettyprint">
$drush @sitename.live ne-node-export
--sql="SELECT nid FROM node where type='your_content_type' and status=0" >
~/myoutput.xml</pre></p>
            <p>Need to debug a node on a live site? Don't want to pull down a 5GB db dump to your local? Don't want
            to enable devel and debug on prod?</p><p><pre class="prettyprint">$drush @sitename.live ev "print_r(node_load(123);"</pre></p>
        </div>
        <div class="step slide" data-x="14000">
            <h4>Continuous Integration</h4>
            <p>Drush is a linchpin in the deployment process. Manual deployments work for simple sites but what
            happens when you have 10 codebases and 4 databases behind load balancers?</p>
            <p>Don't make your CI a collection of scripts for different servers. It's a mess.Remember this?</p>
            <pre class="prettyprint">$drush sql-sync @sitename.staging @sitename</pre>
            <p>Push your database to all environments/masters/slaves in one go.<br>
            Drush aliases have hierarchy which allows you to deploy to sub/supersets depending on how you configure.</p>
        </div>
        <div class="step slide" data-x="15000">
            <h4>Site hacked?</h4>
            <p>Don't try to sanitize your server. We all know (or should) that it's trivially easy to miss some php file
            on the server running somewhere that will just redo the damage.</p>
            <p>Use drush make to rebuild your servers quick and efficiently. Then you just have to worry about the
            database which is easier and safer to sanitize.</p>
            <pre class="prettyprint">
$drush make mysitemakefile.make
$drush site-install --db-url=account:pass@Hostname/dbName
$drush sql-connect < sanitizedDB.sql
$drush pm-enable -y stage_file_proxy
$drush variable-set stage_file_proxy_origin "http://oldsite.org/"
            </pre>
        </div>
        <div class="step slide" data-x="16000">
            <h4>Lock down your servers. Simplify Security</h4>
            <p>There is no reason for you to log on to a server. Drush gives you the tools to work remotely
            using aliases. One user that can only execute a subset of commands.<br> 1 key to rotate, no one altering
                configuration while trying to troubleshoot.
            </p>
        </div>
    </div>
    <!-- End impress container -->
<script src="bower_components/impress.js/js/impress.js"></script>
<script>impress().init();</script>
</body>
